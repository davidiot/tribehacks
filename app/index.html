<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8">

  <title>Phonics</title>
  <meta name="description" content="Phonics for Tribehacks">
  <meta name="author" content="SitePoint">

  <link rel="stylesheet" href="css/styles.css?v=1.0">
  <!-- Bootstrap -->
  <link rel="stylesheet" href="bootstrap-3.3.7-dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="bootstrap-3.3.7-dist/css/bootstrap-theme.min.css">

  <!-- JQuery -->
  <script src="js/jquery-1.12.4.min.js" type="text/javascript"></script>
  <!-- TagCanvas  -->
  <script src="js/tagcanvas.min.js" type="text/javascript"></script>
  <!-- Bootstrap -->
  <script src="bootstrap-3.3.7-dist/js/bootstrap.min.js"></script>

  <script src="js/jquery.csv.min.js" type="text/javascript"></script>

  <script type="text/javascript">
  function tpu(s) {
      console.log(s);
      $('#tagsInfo').html(s[0]);
    }

  $(document).ready(function(){
    var data;
    $.ajax({
      mimeType: 'text/plain; charset=x-user-defined',
      type: "GET",  
      url: "data/sample.csv",
      dataType: "text",       
      success: function(response)  
      {
      data = $.csv.toArrays(response);
      generateCanvasList(data);
      }   
    });
    
    $('#tcReloader').click(function(){
      var data;
      $.ajax({
        mimeType: 'text/plain; charset=x-user-defined',
        type: "GET",  
        url: "data/sample.csv",
        dataType: "text",       
        success: function(response)  
        {
        data = $.csv.toArrays(response);
        generateCanvasList(data);
        }   
      }); 
      TagCanvas.Reload('myCanvas'); 
    });

    function generateCanvasList(data) {
      var text = "<ul>";

      if(typeof(data[0]) === 'undefined') {
        return null;
      } else {
        $.each(data, function( index, row ) {
          //bind header
          text += '<li>' + '<a href="#" ' + "onclick='return tpu("+ JSON.stringify(row) +")'>";
          
          // $(row[0]+'TagID').click({param: row}, processTagInfo);

          $.each(row, function( index, colData ) {
            if (index == 0) {
              text += colData;
            }
          });
          
          text += '</a>' + '</li>';
        });
      
        text += "</ul>";

        $('#tags').html(text);
      }
      
      try {
          TagCanvas.Start('myCanvas','tags',{
            textColour: '#ff0000',
            outlineColour: '#ff00ff',
            reverse: true,
            depth: 0.8,
            maxSpeed: 0.05
          });
        } catch(e) {
          // something went wrong, hide the canvas container
          document.getElementById('myCanvasContainer').style.display = 'none';
        }
    }

    function processTagInfo(event) {
      console.log(event.data.param);
    }
    });
  </script>
</head>

<body>
  <h1>Phonics Application Title</h1>

  <div class="container-fluid">
    <div class="row">
      <div class="col-md-6">
        <div id="myCanvasContainer">
          <canvas width="600" height="600" id="myCanvas">
            <p>Anything in here will be replaced on browsers that support the canvas element</p>
          </canvas>
        </div>

        <button id="tcReloader">Reload</button>
      </div>

      <div class="col-md-6">
        <div id="tagsInfo"></div>
      </div>
    </div>
  </div>

  <div id="tags"></div>
</body>

</html>